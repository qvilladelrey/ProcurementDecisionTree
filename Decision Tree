<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Decision Tree</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-image: url('Decision Tree Background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .decision-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 35px 65px rgba(0.25,0.25,0.25,0.25);
            max-width: 700px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: visible;
        }

        h1 {
            font-family: 'Bricolage Grotesque', 'Arial', sans-serif;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 600;
        }

        .question {
            font-size: 2em;
            color: #555;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
        }

        .options.horizontal {
            flex-direction: row;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .option-btn {
            background: linear-gradient(135deg, #1e3888, #3a6ea5);
            color: white;
            border: none;
            padding: 18px 25px;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            width: 100%;
            max-width: 450px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.3;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .option-btn:active {
            transform: translateY(0);
        }

        .image-option {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 20px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 100%;
            max-width: 280px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            flex: 1;
            min-width: 140px;
        }

        .image-option:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .image-option h3 {
            margin: 12px 0 6px 0;
            color: #333;
            font-size: 1.1em;
            font-weight: 600;
        }

        .image-option p {
            margin: 0;
            color: #666;
            font-size: 0.85em;
            line-height: 1.3;
        }

        .restart-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            margin-right: 10px;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .restart-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .definition-word {
            position: relative;
            cursor: help;
            color: #667eea;
            font-weight: 500;
            border-bottom: 1px dotted #667eea;
        }

        .definition-tooltip {
            position: absolute; /* or fixed if you prefer */
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.85em;
            white-space: normal;
            z-index: 9999; /* ensure it's on top */
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 5px;
            width: 300px;
            text-align: center;
            line-height: 1.2;
            max-height: 80px;
            overflow-y: auto;
        }

        .definition-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #333;
        }

        .definition-word:hover .definition-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .breadcrumb-container {
            background: #f0f4fa;
            border-radius: 8px;
            padding: 12px 14px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .breadcrumb-title {
            font-weight: bold;
            color: #1e3888;
            font-size: 1em;
            margin-bottom: 6px;
        }

        .breadcrumb-trail {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 5px;
        }

        .breadcrumb-btn {
            background: none;
            border: none;
            color: #1e3888;
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.85em;
            padding: 3px 6px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
        .breadcrumb-btn:hover {
            color: #3a6ea5;
            background: rgba(58, 110, 165, 0.1);
        }
        
        .breadcrumb-current {
            color: #333;
            font-weight: 600;
            padding: 3px 6px;
            font-size: 0.85em;
        }

        .recommendation-container {
            margin-bottom: 20px;
        }

        .primary-recommendation {
            background: linear-gradient(135deg, #1e3888, #3a6ea5);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            text-align: left;
        }

        .recommendation-title {
            font-weight: 700;
            font-size: 1.3em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .recommendation-title .icon {
            margin-right: 10px;
            font-size: 1.5em;
        }

        .recommendation-description {
            font-size: 1em;
            line-height: 1.5;
        }

        .alternative-recommendations {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .alternative-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 1.1em;
        }

        .alternative-title .icon {
            margin-right: 8px;
            font-size: 1.2em;
        }

        .alternative-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .alternative-badge {
            background: #f8f9fa;
            color: #333;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .dynamic-recommendations {
            background: #e8f4fd;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.15);
        }

        .dynamic-title {
            font-weight: bold;
            color: #1e3888;
            font-size: 1.1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .dynamic-title .icon {
            margin-right: 8px;
        }

        .recommendation-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .recommendation-badge {
            background: #1e3888;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .learn-more-btn {
            display: inline-block;
            margin-top: 12px;
            background: #1e3888;
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        .learn-more-btn:hover {
            background: #3a6ea5;
        }
        
        .alternative-badge {
            background: #f8f9fa;
            color: #333;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-decoration: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .alternative-badge:hover {
            background: #e8f0ff;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }

        .feedback-btn {
          background: #007bff;
          color: white;
          border: none;
          padding: 15px 30px;
          border-radius: 10px;
          font-size: 1em;
          cursor: pointer;
          transition: all 0.3s ease;
          font-weight: 500;
        }
        
        .feedback-btn:hover {
          background: #0056b3;
          transform: translateY(-1px);
        }

        .user-guide-container {
          position: fixed;
          bottom: 25px;
          right: 25px;
          background: #1e3888;
          color: white;
          padding: 14px 20px;
          border-radius: 12px;
          font-size: 1em;
          font-weight: 500;
          box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
          cursor: pointer;
          transition: transform 0.2s ease, box-shadow 0.2s ease;
          z-index: 9999;
        }
        
        .user-guide-container:hover {
          transform: translateY(-4px);
          box-shadow: 0 10px 22px rgba(0, 0, 0, 0.25);
        }

        @media (max-width: 768px) {
            .decision-container {
                padding: 25px;
                margin: 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .question {
                font-size: 1.1em;
            }
            
            .button-container {
                flex-direction: column;
            }
            
            .restart-btn, .back-btn {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="decision-container">
        <h1>Decision Tree for Modes of Procurement</h1>
        
        <!-- Breadcrumb Trail -->
        <div id="breadcrumbContainer" class="breadcrumb-container" style="display: none;">
            <div class="breadcrumb-title">Your Path:</div>
            <nav id="breadcrumbTrail" class="breadcrumb-trail">
                <!-- Breadcrumb items will be dynamically added here -->
            </nav>
        </div>

        <!-- Dynamic Recommendations Panel -->
        <div id="dynamicRecommendations" class="dynamic-recommendations" style="display: none;">
            <div class="dynamic-title">
                <span class="icon">💡</span>
                <span>Available Procurement Modes:</span>
            </div>
            <div id="recommendationBadges" class="recommendation-badges">
                <!-- Recommendation badges will be dynamically added here -->
            </div>
        </div>
        
        <div id="homeContainer">
            <div class="question" style="font-size: 1.1em; text-align: justified; margin-bottom: 30px;">
                This decision tree for modes of procurement is a step-by-step guide that uses yes/no or conditional questions to determine the most appropriate procurement method based on thresholds, conditions, and justifications. It ensures Procuring Entities choose which mode of procurement is the most fit for their desired purpose, in accordance with the <span class="definition-word">Fit-for-Purpose<span class="definition-tooltip">Fit-for-Purpose refers to an approach to procurement that applies the most suitable mechanism or strategy designed to address the specific needs of the Procuring Entity and each project, while promoting flexibility and responsiveness to different conditions and scenarios, based on factors or situations, such as, but not limited to, the nature and complexity of the project, market condition and readiness, urgency or risks, in order to ensure and achieve value for money.</span></span> Approach under Republic Act No. 12009 or the New Government Procurement Act.
            </div>
            
            <div class="options">
                <img src="START.png" onclick="startDecisionTree()" style="width: 280px; height: 90px; object-fit: cover; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: block; margin: 0 auto;" alt="Start icon" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'" onmousedown="this.style.transform='scale(0.95)'" onmouseup="this.style.transform='scale(1.05)'" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
            </div>
        </div>

        <div id="questionContainer" style="display: none;">
            <div class="question" id="questionText">
                What are you procuring?
            </div>
            
            <div class="options" id="optionsContainer">
                <div class="image-option" onclick="makeChoice('goods')">
                    <img src="Billy Goods.png" style="width: 290px; height: 260px; object-fit: cover; border-radius: 8px;" alt="Goods icon" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                    <h3><span class="definition-word">Goods<span class="definition-tooltip">Goods refer to (i) all items, supplies, and  materials, whether in the nature of equipment, furniture, stationery, materials for construction, or personal property of any kind, needed in the transaction of public businesses or in the pursuit of any government undertaking, project or activity; or (ii) general support services which pertain to all types of services except Consulting Services and Infrastructure Projects, such as the repair and maintenance of equipment and furniture, as well as trucking, hauling, janitorial, security, and related or analogous services. Personnel Services or individual COS or JO engagements do not fall under this definition.</span></span></h3>
                </div>
                <div class="image-option" onclick="makeChoice('infrastructure')">
                    <img src="Billy Infra.png" style="width: 290px; height: 260px; object-fit: cover; border-radius: 8px;" alt="Infrastructure icon" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                    <h3>Infrastructure Projects</h3>
                </div>
                <div class="image-option" onclick="makeChoice('consulting')">
                    <img src="Billy Consulting.png" style="width: 290px; height: 260px; object-fit: cover; border-radius: 8px;" alt="Consulting icon" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                    <h3>Consulting Services</h3>
                </div>
            </div>
            
            <!-- Back Button -->
            <div class="button-container">
                <button onclick="goBack()" class="back-btn" id="backButton" style="display: none;">
                    ← Go Back
                </button>
            </div>
        </div>
        
        <div id="resultContainer" style="display: none;">
            <div class="recommendation-container" id="recommendationContainer">
                <!-- Primary and alternative recommendations will be inserted here -->
            </div>
            <div class="button-container">
                <button class="restart-btn" onclick="restart()">
                    🔄 Start Over
                </button>
        
        <!-- ✨ New Feedback Button -->
        <button class="feedback-btn" onclick="openFeedbackForm()">
            💬 Give Feedback
            </button>
            </div>
        </div>

        <div class="user-guide-container" onclick="openUserGuide()">
          📘 User Guide
        </div>

    </div>

    <script>
        const decisionTree = {
            start: {
                question: "What are you procuring?",
                options: {
                    goods: {
                        text: "📦 Goods",
                        next: "isthereemergency_goods"
                    },
                    infrastructure: {
                        text: "🏗️ Infrastructure Projects",
                        next: "result_underconstruction"
                    },
                    consulting: {
                        text: "🤝 Consulting Services",
                        next: "result_underconstruction"
                    }
                }
            },
            isthereemergency_goods: {
                question: "Is there:",
                options: {
                    imminentdanger_goods: {
                        text: "🌪️ Address imminent danger to life or property during a state of calamity",
                        next: "prefer_emergencycases_goods",
                        triggers: ["Negotiated Procurement: Emergency Cases", "Small Value Procurement", "Competitive Bidding"]
                    },
                    timeessence_goods: {
                        text: "🔥 Implement prompt measures since time is of the essence in situations arising from natural or man-made calamities",
                        next: "prefer_emergencycases_goods",
                        triggers: ["Negotiated Procurement: Emergency Cases", "Small Value Procurement", "Competitive Bidding"]
                    },
                    immediateaction_goods: {
                        text: "🚨 A need to undertake immediate action to prevent damage to or loss of life or property or to restore vital public  services, infrastructure facilities,  and other public utilities",
                        next: "prefer_emergencycases_goods",
                        triggers: ["Negotiated Procurement: Emergency Cases", "Small Value Procurement", "Competitive Bidding"]
                    },
                    otherinstancesemergency_goods: {
                        text: "⚠️ Respond to other instances aside from the mentioned situations where the provision of life, injury, disease, and other negative effects on human, physical, mental and social well-being, together with damage to property, destruction of assets, loss of services, social and economic disruption and environmental degradation",
                        next: "prefer_emergencycases_goods",
                        triggers: ["Negotiated Procurement: Emergency Cases", "Small Value Procurement", "Competitive Bidding"]
                    },
                    othersemergency_goods: {
                        text: "❓ Not among the stated options",
                        next: "cse_goods"
                    }
                }
            },
            prefer_emergencycases_goods: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_emergencycases_goods: {
                        text: "📋 Revise Annual Procurement Plan (APP) as necessary and adopt Negotiated Procurement",
                        next: "result_emergencycases"
                    },
                    different_prefer_emergencycases_goods: {
                        text: "🔄 Adopt different procurement mode",
                        next: "cse_goods"
                       }
                    }
                },
                cse_goods: {
                    question: "Is it CSE?",
                    options: {
                    yes: {
                        text: "✅ Yes",
                        next: "availablepsdbm_cse"
                    },
                    no: {
                        text: "❌ No",
                        next: "previouslyprocured_noncse"
                    }
                }
            },
            previouslyprocured_noncse: {
                question: "Was the Good procured previously?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "need_noncsegoods"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            need_noncsegoods: {
                question: "Is there a need to:",
                options: {
                    directpurchase_noncse: {
                        text: "🔄 Directly purchase from supplier that has delivered non-CSE to other government agency",
                        next: "directsales_previousprocurement_competitive"
                    },
                    takeovercontract_noncse: {
                        text: "🚨Take-over previously awarded contract that was rescinded or terminated for causes provided for in the contract and existing laws, in order to prevent damage to or loss of life or property or restore vital public services, etc.",
                        next: "previouscontract_takeovercontract_noncse"
                    },
                    twofailedbidding_noncse: {
                        text: "🔄 Procure again due to two (2) failures of bidding (Competitive Bidding, Limited Source Bidding, or Competitive Dialogue)",
                        next: "prefer_twofailedbidding_noncse",
                        triggers: ["Negotiated Procurement: Two-Failed Biddings"]
                    },
                    replenishgoods_noncse: {
                        text: "📋 Replenish Goods procured under a previously awarded contract",
                        next: "repeatorder_previousprocurement_competitive_noncse"
                    },
                    othergoods_noncse: {
                        text: "❓ Not among the stated options",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            previouscontract_takeovercontract_noncse: {
                question: "Was the previous contract awarded through Competitive Bidding, Competitive Dialogue, Limited Source Bidding, or Small Value Procurement?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_takeover_noncse",
                        triggers: ["Negotiated Procurement: Take-Over of Contracts"]
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            prefer_takeover_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_takeover_noncse: {
                        text: "📋 Post-Qualify and negotiate with the second (2nd) lowest Lowest Calculated (LC) or Most Advantageous (MA) bidder and adopt Negotiated Procurement",
                        next: "result_takeoverofcontracts"
                    },
                    different_prefer_takeover_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            directsales_previousprocurement_competitive: {
                question: "Was the original Non-CSE procured and awarded through Competitive Bidding, Limited Source Bidding, Competitive Dialogue or Unsolicited Offer with Bid Matching?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "directsales_certificateofsatisfactoryperformance"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            directsales_certificateofsatisfactoryperformance: {
                question: "Did the original government agency inspect and accept the same, and has issued a certification that the supplier has satisfactorily performed its obligations under the contract?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "directsales_previousprocurement_sixmonths"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            directsales_previousprocurement_sixmonths: {
                question: "Is the procurement  only initiated once within six (6) months from the acceptance of the Non-CSE by the original government agency?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "directsales_lowerunitprice"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            directsales_lowerunitprice: {
                question: "Is the  contract to be executed between the PE & the supplier within the amount of the contract executed with the original government agency, and offered to the PE at the same or lower unit price offered to the original govt agency?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "directsales_suppliercapability"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            directsales_suppliercapability: {
                question: "Did the supplier agree to the terms offered by the PE and remains legally, technically, and financially capable to undertake the contract with the PE?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_directsales",
                        triggers: ["Direct Sales"]
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            prefer_directsales: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_directsales: {
                        text: "🤝 Coordinate with the government agency that originally procured the non-CSE",
                        next: "result_directsales"
                    },
                    different_prefer_directsales: {
                        text: "🔄 Adopt different procurement mode",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            prefer_twofailedbidding_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_twofailedbidding_noncse: {
                        text: "📋 To Review terms, conditions, specifications, and cost estimates, and adjust ABC, if necessary and approved",
                        next: "result_twofailedbiddings"
                    },
                    different_prefer_twofailedbidding_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            repeatorder_previousprocurement_competitive_noncse: {
                question: "Was the good procured under a contract previously awarded through Competitive Bidding, Limited Source Bidding, Competitive Dialogue, or Unsolicited Offer with Bid Matching?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "repeatorder_lowerunitprice_noncse"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            repeatorder_lowerunitprice_noncse: {
                question: "Is the unit price equal to or lower than that provided in the original contract and the prevailing market price?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "repeatorder_previousprocurement_sixmonths_noncse"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            repeatorder_previousprocurement_sixmonths_noncse: {
                question: "Is the procurement within six (6) months from the date of the NTP arising from the original contract?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "repeatorder_quantifiablegood_noncse"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            repeatorder_quantifiablegood_noncse: {
                question: "Is the Good quantifiable, divisible, and consisting of at least four (4) units per item, and does not exceed 25% of the quantity of each item in the original contract?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_repeatorder_noncse",
                        triggers: ["Repeat Order"]
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            prefer_repeatorder_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_repeatorder_noncse: {
                        text: "📋 To Prepare Purchase Request and adopt Repeat Order",
                        next: "result_repeatorder"
                    },
                    different_prefer_repeatorder_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "typeofgood_noncse_b"
                    }
                }
            },
            typeofgood_noncse_b: {
                question: "Is the Good:",
                options: {
                    petroleumproducts: {
                        text: "⛽ Petroleum Fuel, Oil and Lubricant Products",
                        next: "retailpumpprice"
                    },
                    electronicchargingdevice: {
                        text: "🚗 Electronic charging device intended for electric vehicles",
                        next: "retailpumpprice"
                    },
                    onlinesubscription: {
                        text: "💻 Online subscription",
                        next: "onlinesubscription_availablepsdbm"
                    },
                    agriculturalproduct: {
                        text: "🌾🐟 Agricultural or fishery product",
                        next: "sagipsaka_accreditedffce"
                    },
                    majordefenseequipment: {
                        text: "🚁 Major defense equipment or materiel deemed necessary to protect the country by the Secretary of the Department of National Defense",
                        next: "afpmodernizationprogram_noncse"
                    },
                    scientifcscholarlyetc: {
                        text: "🔬🎨💻🎥📚 Scientific, scholarly or artistic work, exclusive technology and/or media services",
                        next: "typeofgood_scientificscholarly_noncse"
                    },
                    realpropertyorvenue: {
                        text: "🏢 Lease of Real Property or Venue",
                        next: "publicownedvenue"
                    },
                    othergoods_noncse: {
                        text: "❓ Not among the stated options",
                        next: "newconcepttechnology_noncse"
                    }
                }
            },
            retailpumpprice: {
                question: "Is it available from retailers, dealers, or gas stations at retail pump price?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "immediateconsumption"
                    },
                    no: {
                        text: "❌ No",
                        next: "directacquisition_abc_noncse"
                    }
                }
            },
            immediateconsumption: {
                question: "Will it be used for any official government vehicle and equipment for immediate consumption?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "directacquisition_abc_pol",
                        triggers: ["Negotiated Procurement: Direct Retail Purchase of Petroleum Fuel, Oil and Lubricant Products, Electronic Charging Devices, and Online Subscriptions"]
                    },
                    no: {
                        text: "❌ No",
                        next: "result_underconstruction"
                    }
                }
            },
            directacquisition_abc_pol: {
                question: "Is the ABC less than Php 200,000.00?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "directacquisition_invoicecompliant_pol"
                    },
                    no: {
                        text: "❌ No",
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            directacquisition_invoicecompliant_pol: {
                question: "Does the supplier issue invoices compliant with the Bureau of Internal Revenue (BIR) and Commission on Audit (COA)?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_directacquisition_pol",
                        triggers: ["Direct Acquisition"]
                    },
                    no: {
                        text: "❌ No",
                        next: "directacquisition_abc_pol"
                    }
                }
            },
            prefer_directacquisition_pol: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_directacquisition_pol: {
                        text: "🤝 Adopting Direct Acquisition",
                        next: "result_directacquisition"
                    },
                    different_prefer_directacquisition_pol: {
                        text: "🔄 Adopt different procurement mode",
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            smallvalueprocurement_abc: {
                question: "Is the ABC more than P2 million?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "result_competitivebidding"
                    },
                    no: {
                        text: "❌ No",
                        next: "prefer_competitivebidding_noncse",
                        triggers: ["Small Value Procurement"]
                    }
                }
            },
            prefer_competitivebidding_noncse: {
                question: "Do you prefer/have the capacity to undertake the public bidding process?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "result_competitivebidding"
                    },
                    no: {
                        text: "❌ No",
                        next: "result_smallvalueprocurement"
                    }
                }
            },
            onlinesubscription_availablepsdbm: {
                question: "Is it available at PS-DBM?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "result_underconstruction"
                    },
                    no: {
                        text: "❌ No",
                        next: "onlinesubscription_localprovider"
                    }
                }
            },
            onlinesubscription_localprovider: {
                question: "Is there an available local service provider?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "smallvalueprocurement_abc"
                    },
                    no: {
                        text: "❌ No",
                        next: "onlinesubscription_abc"
                    }
                }
            },
            onlinesubscription_abc: {
                question: "Is the ABC more than Php 1 million?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "onlinesubscription_abc_hopeapproval",
                        triggers: ["Negotiated Procurement: Direct Retail Purchase of Petroleum Fuel, Oil and Lubricant Products, Electronic Charging Devices, and Online Subscriptions"]
                    },
                    no: {
                        text: "❌ No",
                        next: "result_competitivebidding"
                    }
                }
            },
            onlinesubscription_abc_hopeapproval: {
                question: "Is the ABC below 5 million (with HoPE approval)?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_publicbidding_onlinesubscription",
                        triggers: ["Negotiated Procurement: Direct Retail Purchase of Petroleum Fuel, Oil and Lubricant Products, Electronic Charging Devices, and Online Subscriptions"]
                    },
                    no: {
                        text: "❌ No",
                        next: "result_competitivebidding"
                    }
                }
            },
            prefer_publicbidding_onlinesubscription: {
                question: "Do you prefer/have the capacity to undertake the public bidding process?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "result_competitivebidding"
                    },
                    no: {
                        text: "❌ No",
                        next: "result_smallvalueprocurement"
                    }
                }
            },
            prefer_directretail_onlinesubscription: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_directretail_onlinesubscription: {
                        text: "🤝 Adopting Direct Retail",
                        next: "result_directacquisition"
                    },
                    different_prefer_directretail_onlinesubscription: {
                        text: "🔄 Adopt different procurement mode",
                        next: "prefer_publicbidding_onlinesubscription"
                    }
                }
            },
            sagipsaka_accreditedffce: {
                question: "Is the supplier an accredited FFCE?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "result_underconstruction"
                    },
                    no: {
                        text: "❌ No",
                        next: "newconcepttechnology_noncse"
                    }
                }
            },
            afpmodernizationprogram_noncse: {
                question: "Is the Good included in the AFP Modernization Program previously approved by the President of the Philippines?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "afpmodernizationprogram_directnegotiation_noncse",
                        triggers: ["Negotiated Procurement: Defense Cooperation Agreements and Inventory-Based Items"]
                    },
                    no: {
                        text: "❌ No",
                        next: "prefer_defensecooperation_noncse"
                    }
                }
            },
            afpmodernizationprogram_directnegotiation_noncse: {
                question: "Will direct negotiation address compatibility, interoperability, and sustainability?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "afpmodernizationprogram_previouscontract_noncse"
                    },
                    no: {
                        text: "❌ No",
                        next: "newconcepttechnology_noncse"
                    }
                }
            },
            afpmodernizationprogram_previouscontract_noncse: {
                question: "Has the supplier/manufacturer fully & satisfactorily implemented a contract of the same item with the DND, any of its bureaus or attached agencies, or law enforcement agencies?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "afpmodernizationprogram_performancesecurity_noncse"
                    },
                    no: {
                        text: "❌ No",
                        next: "newconcepttechnology_noncse"
                    }
                }
            },
            afpmodernizationprogram_performancesecurity_noncse: {
                question: "Will the supplier or manufacturer provide performance security in accordance with RA 12009?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_defensecooperation_noncse",
                        triggers: ["Negotiated Procurement: Defense Cooperation Agreements and Inventory-Based Items"]
                    },
                    no: {
                        text: "❌ No",
                        next: "newconcepttechnology_noncse"
                    }
                }
            },
            prefer_defensecooperation_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_defensecooperation_noncse: {
                        text: "🤝 Adopting Direct Retail",
                        next: "result_defensecooperationagreement"
                    },
                    different_prefer_defensecooperation_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "newconcepttechnology_noncse"
                    }
                }
            },
            typeofgood_scientificscholarly_noncse: {
                question: "Is the Good:",
                options: {
                    workofart: {
                        text: "🎨 Work of art; commissioned work or services for creative design or a specific artist skill (e.g., singer, performer, poet, writer, painter, sculptor, etc.)",
                        next: "prefer_scientificscholarly_noncse",
                        triggers: ["Negotiated Procurement: Scientific, Scholarly or Artistic Work, Exclusive Technology and Media Services"]
                    },
                    scientificpublication: {
                        text: "📚 Scientific, technical, economic, business, trade or legal journal, magazine, paper, subscription, or other exclusive statistical publications and references",
                        next: "prefer_scientificscholarly_noncse",
                        triggers: ["Negotiated Procurement: Scientific, Scholarly or Artistic Work, Exclusive Technology and Media Services"]
                    },
                    medicalbiotech: {
                        text: "🔬 Highly specialized life-saving medical and biotech equipment and devices, medicine, supplies, materials, tools and consumables, as certified by the Department of Health",
                        next: "prefer_scientificscholarly_noncse",
                        triggers: ["Negotiated Procurement: Scientific, Scholarly or Artistic Work, Exclusive Technology and Media Services"]
                    },
                    mediadocumentation: {
                        text: "🎥 Media documentation, advertisement, or announcement through television, radio, newspaper, internet, and other communication media",
                        next: "prefer_scientificscholarly_noncse",
                        triggers: ["Negotiated Procurement: Scientific, Scholarly or Artistic Work, Exclusive Technology and Media Services"]
                    },
                    othergoods_scientificscholarlyetc_noncse: {
                        text: "❓ Not among the stated options",
                        next: "newconcepttechnology_noncse"
                    }
                }
            },
            prefer_scientificscholarly_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_scientificscholarly_noncse: {
                        text: "🤝 Adopting Negotiated Procurement",
                        next: "result_scientificscholarlyetc"
                    },
                    different_prefer_scientificscholarly_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "newconcepttechnology_noncse"
                    }
                }
            },
            publicownedvenue: {
                question: "Is the real property or venue publicly-owned/ from other government agency?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "agencymandate_realpropertyvenue"
                    },
                    no: {
                        text: "❌ No",
                        next: "efficientandeconomical_venue"
                    }
                }
            },
            efficientandeconomical_venue: {
                question: "Is the offer of the private supplier more efficient and economical to the government?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_realpropertyvenue_noncse",
                        triggers: ["Negotiated Procurement: Lease of Real Property and Venue"]
                    },
                    no: {
                        text: "❌ No",
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            prefer_realpropertyvenue_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_realpropertyvenue: {
                        text: "🤝 Adopting Negotiated Procurement",
                        next: "result_leaseofrealproperty"
                    },
                    different_prefer_realpropertyvenue: {
                        text: "🔄 Adopt different procurement mode",
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            agencymandate_realpropertyvenue: {
                question: "Is the government agency mandated to undertake the project?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_agencytoagency_realpropertyvenue",
                        triggers: ["Negotiated Procurement: Agency-to-Agency"]
                    },
                    no: {
                        text: "❌ No",
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            prefer_agencytoagency_realpropertyvenue: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_agencytoagency_realpropertyvenue: {
                        text: "🤝 Enter into Contract with Agency",
                        next: "result_agencytoagency"
                    },
                    different_prefer_agencytoagecny_realpropertyvenue: {
                        text: "🔄 Adopt different procurement mode",
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            newconcepttechnology_noncse: {
                question: "Is the Good a new concept or technology?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "unsolicitedoffer_noncse"
                    },
                    no: {
                        text: "❌ No",
                        next: "result_underconstruction"
                    }
                }
            },
            unsolicitedoffer_noncse: {
                question: "Was an unsolicited offer initially submitted by an entity that was determined by the PE as necessary?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "typeofgood_unsolicitedofferwithbidmatching_noncse"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_competitivedialogue_noncse"
                    }
                }
            },
            typeofgood_competitivedialogue_noncse: {
                question: "Does the Good:",
                options: {
                    innovativedesign_competitivedialogue_noncse: {
                        text: "Include innovative design or solutions involving procurement of complex purchases such as, but not limited to, intellectual services, major information communications technology projects, or sophisticated products that may refer to goods or services, which in order to be produced or offered, would require a high level of technology, human capital, competencies or facility",
                        next: "prefer_competitivedialogue_noncse",
                        triggers: ["Competitive Dialogue"]
                    },
                    priornegotiation_competitivedialogue_noncse: {
                        text: "Has a contract that requires prior negotiations with the suppliers because of specific circumstances related to nature, complexity, legal and financial issues, or risks attached to the procurement",
                        next: "prefer_competitivedialogue_noncse",
                        triggers: ["Competitive Dialogue"]
                    },
                    undefinedtechspecs_competitivedialogue_noncse: {
                        text: "Has Technical Specifications that cannot be sufficiently established or precisely defined by the PE",
                        next: "prefer_competitivedialogue_noncse",
                        triggers: ["Competitive Dialogue"]
                    },
                    othergoods_competitivedialogue_noncse: {
                        text: "❓ Not among the stated options",
                        next: "researchuse_noncse"
                    }
                }
            },
            prefer_competitivedialogue_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_competitivedialogue_noncse: {
                        text: "🤝 Employ a 2-stage bidding process where the PE invites suppliers etc., to propose solutions to address its needs and requirements",
                        next: "result_agencytoagency"
                    },
                    different_prefer_competitivedialogue_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "researchuse_noncse"
                    }
                }
            },
            researchuse_noncse: {
                question: "Is the Good to be used actually, exclusively, and directly in the conduct of research and development projects or activities?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "typeofgood_sti_noncse"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_limitedsourcebidding_noncse"
                    }
                }
            },
            typeofgood_sti_noncse: {
                question: "Is the Good:",
                options: {
                    actualscience: {
                        text: "Supplies, materials, equipment and related services to be used actually, exclusively, and directly in the conduct of research and development projects or activities",
                        next: "prefer_directsti_noncse",
                        triggers: ["Direct Procurement for Science, Technology, and Innovation"]
                    },
                    priornegotiation_competitivedialogue_noncse: {
                        text: "Goods which include products of a commissioned task by a PE which where processed, developed, and manufactured in satisfaction of its needs and requirements, which include: (i) pre-commercial goods and services that involve early market engagement to stimulate the development of new goods and services that meet specific government needs; and (ii) goods to be manufactured by qualified start up businesses alongside the thrust to develop and support new businesses",
                        next: "prefer_directsti_noncse",
                        triggers: ["Direct Procurement for Science, Technology, and Innovation"]
                    },
                    sti_analogous: {
                        text: "Other analogous goods",
                        next: "prefer_directsti_noncse",
                        triggers: ["Direct Procurement for Science, Technology, and Innovation"]
                    },
                    othergoods_sti_noncse: {
                        text: "❓ Not among the stated options",
                        next: "typeofgood_limitedsourcebidding_noncse"
                    }
                }
            },
            prefer_directsti_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_directsti_noncse: {
                        text: "🤝 Adopting Direct Procurement",
                        next: "result_directprocurementforsti"
                    },
                    different_prefer_directsti_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "totalsuppliers_noncse"
                    }
                }
            },
            totalsuppliers_noncse: {
                question: "Based on your market scoping, how many capable suppliers are available?",
                options: {
                    one_directcontracting_noncse: {
                        text: "One (1)",
                        next: "typeofgood_directcontracting_noncse"
                    },
                    morethanone_limitedsourcebidding_noncse: {
                        text: "More than one (1)",
                        next: "approvedlist_limitedsourcebidding_noncse"
                    }
                }
            },
            approvedlist_limitedsourcebidding_noncse: {
                question: "Are the set of pre-selected suppliers included in the govt approved or self-generated supplier list?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "typeofgood_limitedsourcebidding_noncse"
                    },
                    no: {
                        text: "❌ No",
                        next: "result_underconstruction"
                    }
                }
            },
            typeofgood_limitedsourcebidding_noncse: {
                question: "Is the Good:",
                options: {
                    majorplantcomponent: {
                        text: "A major plant component where it is deemed advantageous to limit the bidding to known eligible bidders in order to maintain an optimum and uniform level of quality and performance of the plant as a whole",
                        next: "prefer_limitedsourcebidding_noncse",
                        triggers: ["Limited Source Bidding"]
                    },
                    highlyspecialized_noncse: {
                        text: "Goods which include products of a commissioned task by a PE which where processed, developed, and manufactured in satisfaction of its needs and requirements, which include: (i) pre-commercial goods and services that involve early market engagement to stimulate the development of new goods and services that meet specific government needs; and (ii) goods to be manufactured by qualified start up businesses alongside the thrust to develop and support new businesses",
                        next: "prefer_limitedsourcebidding_noncse",
                        triggers: ["Limited Source Bidding"]
                    },
                    othergoods_limitedsourcebidding_noncse: {
                        text: "❓ Not among the stated options",
                        next: "result_underconstruction"
                    }
                }
            },
            prefer_limitedsourcebidding_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_limitedsourcebidding_noncse: {
                        text: "🤝 Direct invitation to bid by the PE to a set of pre-selected suppliers",
                        next: ""
                    },
                    different_prefer_limitedsourcebidding_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "result_underconstruction"
                    }
                }
            },
            typeofgood_directcontracting_noncse: {
                question: "Is the Good:",
                options: {
                    exclusivedealer_noncse: {
                        text: "Sold by an exclusive dealer or manufacturer which does not have sub-dealers selling at lower prices and for which no suitable substitute can be obtained at more advantageous terms to the government",
                        next: "prefer_directcontracting_noncse",
                        triggers: ["Direct Contracting"]
                    },
                    criticalcomponent_noncse: {
                        text: "A critical component from a specific manufacturer, supplier, or distributor is a condition precedent to hold a service provider to guarantee its project performance, in accordance with the provisions of the contract, as determined by the EU/IU",
                        next: "prefer_directcontracting_noncse",
                        triggers: ["Direct Contracting"]
                    },
                    proprietarygood_noncse: {
                        text: "Proprietary in nature, which can only be obtained from the proprietary source; or when patents, trade secrets, and copyrights prohibit others from manufacturing the same item, as supported by relevant documentary evidence issued by competent authority",
                        next: "prefer_directcontracting_noncse",
                        triggers: ["Direct Contracting"]
                    },
                    othergoods_directcontracting_noncse: {
                        text: "❓ Not among the stated options",
                        next: "typeofsupplier_noncse"
                    }
                }
            },
            prefer_directcontracting_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_directcontracting_noncse: {
                        text: "🤝 Adopt Direct Contracting and prepare Price Quotation or Pro Forma Invoice w/ Conditions of Sale",
                        next: "result_directcontracting"
                    },
                    different_prefer_directcontracting_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "typeofsupplier_noncse"
                    }
                }
            },
            typeofgood_unsolicitedofferwithbidmatching_noncse: {
                question: "Does the Good:",
                options: {
                    exclusivedealer_noncse: {
                        text: "Sold by an exclusive dealer or manufacturer which does not have sub-dealers selling at lower prices and for which no suitable substitute can be obtained at more advantageous terms to the government",
                        next: "result_limitedsourcebidding"
                    },
                    criticalcomponent_noncse: {
                        text: "A critical component from a specific manufacturer, supplier, or distributor is a condition precedent to hold a service provider to guarantee its project performance, in accordance with the provisions of the contract, as determined by the EU/IU",
                        next: "result_limitedsourcebidding"
                    },
                    proprietarygood_noncse: {
                        text: "Proprietary in nature, which can only be obtained from the proprietary source; or when patents, trade secrets, and copyrights prohibit others from manufacturing the same item, as supported by relevant documentary evidence issued by competent authority",
                        next: "result_limitedsourcebidding"
                    },
                    othergoods_directcontracting_noncse: {
                        text: "❓ Not among the stated options"
                        next: "typeofsupplier_noncse"
                    }
                }
            },
            typeofsupplier_noncse: {
                question: "Is the supplier:",
                options: {
                    unagency_noncse: {
                        text: "United Nations (UN) Agencies, International Organizations  or International Financing Institutions",
                        next: "typeofgood_unagency_noncse"
                    },
                    ngo_noncse: {
                        text: "SEC registered non-stock, non-profit domestic corporation OR CDA-registered cooperative",
                        next: "ngo_appropriationlaw_noncse"
                    },
                    governmentagency_noncse: {
                        text: "Another agency that has the mandate and absorptive capacity to undertake the project, as validated by the PE",
                        next: "necessarytools_agencytoagency_noncse"
                    },
                    community_noncse: {
                        text: "Part of a local community or social groups  (CSG)",
                        next: "prefer_localcommunity_noncse"
                    },
                    othersupplier_noncse: {
                        text: "❓ Not among the stated options"
                        next: "typeofgood_directacquisition_noncse"
                    }
                }
            },
            typeofgood_unagency_noncse: {
                question: "Is the Good:",
                options: {
                    advancedtechnology_unagency_noncse: {
                        text: "Goods involving advanced technologies, techniques, and innovations not locally available as certified by the DTI, when it is most advantageous to the PE",
                        next: "prefer_unagency_noncse",
                        triggers: ["Negotiated Procurement: United Nations (UN) Agencies, International Organization or International Financing Organizations"]
                    },
                    specializedproduct_unagency_noncse: {
                        text: "Specialized products where the number of suppliers is limited, such as vaccines",
                        next: "prefer_unagency_noncse",
                        triggers: ["Negotiated Procurement: United Nations (UN) Agencies, International Organization or International Financing Organizations"]
                    },
                    educationandhealth_unagency_noncse: {
                        text: "Small quantities of off-the-shelf goods exclusively used in education and health",
                        next: "prefer_unagency_noncse",
                        triggers: ["Negotiated Procurement: United Nations (UN) Agencies, International Organization or International Financing Organizations"]
                    },
                    criticalpublichealth_unagency_noncse: {
                        text: "Goods for critical public health priorities as determined and certified by the DOH",
                        next: "prefer_unagency_noncse",
                        triggers: ["Negotiated Procurement: United Nations (UN) Agencies, International Organization or International Financing Organizations"]
                    },
                    othergoods_unagency_noncse: {
                        text: "❓ Not among the stated options"
                        next: "typeofgood_directacquisition_noncse"
                    }
                }
            },
            prefer_unagency_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_unagency_noncse: {
                        text: "🤝 Enter into a Memorandum of Agreement with the identified agency",
                        next: "result_unagencies"
                    },
                    different_prefer_unagency_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "typeofgood_directacquisition_noncse"
                    }
                }
            },
            ngo_appropriationlaw_noncse: {
                question: "Is there an appropriation law or ordinance earmarking an amount to be specifically contacted out to NGOs?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_ngoparticipation_noncse",
                        triggers: ["Negotiated Procurement: Community Participation"]
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_directacquisition_noncse"
                    }
                }
            },
            prefer_ngoparticipation_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_ngoparticipation_noncse: {
                        text: "🤝 Enter into a Memorandum of Agreement with the identified NGO",
                        next: "result_ngoparticipation"
                    },
                    different_prefer_ngoparticipation_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "typeofgood_directacquisition_noncse"
                    }
                }
            },
            necessarytools_agencytoagency_noncse: {
                question: "Does the Servicing Agency (SA) own or has access to the necessary tools and equipment required for the project?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_agencytoagency_noncse",
                        triggers: ["Negotiated Procurement: Agency-to-Agency"]
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_directacquisition_noncse"
                    }
                }
            },
            prefer_agencytoagency_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_agencytoagency_noncse: {
                        text: "🤝 Enter into a Memorandum of Agreement with the identified agency",
                        next: "result_ngoparticipation"
                    },
                    different_prefer_agencytoagency_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "typeofgood_directacquisition_noncse"
                    }
                }
            },
            prefer_localcommunity_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_localcommunity_noncse: {
                        text: "🤝 Adpopting Negotiated Procurement",
                        next: "result_communityparticipation"
                    },
                    different_prefer_localcommunity_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            directacquisition_abc_noncse: {
                question: "Is the ABC less than Php 200,000.00?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "smallvalueprocurement_abc"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_directacquisition_noncse"
                    }
                }
            },
            typeofgood_directacquisition_noncse: {
                question: "Is the Good:",
                options: {
                    services_directacquisition_noncse: {
                        text: "Services that may be procured from service providers, such as but not limited to, furniture repair, automotive service, restoration service, machine and fabrication, and other related services",
                        next: "availability_directacquisition_noncse"
                    },
                    stores_directacquisition_noncse: {
                        text: "May be procured from stores, such as but not limited to, department store, depot, fast food chain, grocery and supermarket, wholesale and retail store, convenience store, clothing and apparel store, bookstore, drugstore and pharmacy, automotive parts and accessories store, construction and hardware store, and online stores",
                        next: "availability_directacquisition_noncse"
                    },
                    othergoods_directacquisition_noncse: {
                        text: "❓ Not among the stated options"
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            availability_directacquisition_noncse: {
                question: "Is the Good:",
                options: {
                    philgepsregistered_directacquisition_noncse: {
                        text: "Supplied by a supplier registered with the PhilGEPS as verified from the PhilGEPS website",
                        next: "directacquisition_invoicecompliant_noncse"
                    },
                    ecommerce_directacquisition_noncse: {
                        text: "Available in electronic commerce platforms for delivery or pick up at such date and time identified by the PE",
                        next: "directacquisition_invoicecompliant_noncse"
                    },
                    immediatedelivery_directacquisition_noncse: {
                        text: "Readily available off-the-shelf and can be picked up or delivered immediately",
                        next: "directacquisition_invoicecompliant_noncse"
                    },
                    otheravailability_directacquisition_noncse: {
                        text: "❓ Not among the stated options"
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            directacquisition_invoicecompliant_noncse: {
                question: "Does the supplier issue invoices compliant with the Bureau of Internal Revenue (BIR) and Commission on Audit (COA)?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_directacquisition_noncse",
                        triggers: ["Direct Acquisition"]
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_directacquisition_noncse"
                    }
                }
            },
            prefer_directacquisition_noncse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_directacquisition_noncse: {
                        text: "🤝 Adopting Direct Acquisition",
                        next: "result_communityparticipation"
                    },
                    different_prefer_directacquisition_noncse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            availablepsdbm_cse: {
                question: "Is it available at PS-DBM?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "result_underconstruction"
                    },
                    no: {
                        text: "❌ No",
                        next: "result_underconstruction"
                    }
                }
            },
            previouslyprocured_cse: {
                question: "Was the Good procured previously?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "need_csegoods"
                    },
                    no: {
                        text: "❌ No",
                        next: "result_underconstruction"
                    }
                }
            },
            need_csegoods: {
                question: "Is there a need to:",
                options: {
                    takeovercontract_cse: {
                        text: "🚨 Take-over previously awarded contract that was rescinded or terminated for causes provided for in the contract and existing laws, in order to prevent damage to or loss of life or property or restore vital public services, etc.",
                        next: "previouscontract_takeovercontract_cse"
                    },
                    twofailedbidding_cse: {
                        text: "🔄 Procure again due to two (2) failures of bidding (Competitive Bidding, Limited Source Bidding, or Competitive Dialogue)",
                        next: "prefer_twofailedbidding_cse",
                        triggers: ["Negotiated Procurement: Two-Failed Biddings"]
                    },
                    replenishgoods_cse: {
                        text: "📋 Replenish Goods procured under a previously awarded contract",
                        next: "repeatorder_previousprocurement_competitive_cse"
                    },
                    othergoods_cse: {
                        text: "❓ Not among the stated options",
                        next: "directacquisition_abc_cse"
                    }
                }
            },
            previouscontract_takeovercontract_cse: {
                question: "Was the previous contract awarded through Competitive Bidding, Competitive Dialogue, Limited Source Bidding, or Small Value Procurement?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_takeover_cse",
                        triggers: ["Negotiated Procurement: Take-Over of Contracts"]
                    },
                    no: {
                        text: "❌ No",
                        next: "directacquisition_abc_cse"
                    }
                }
            },
            prefer_takeover_cse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_takeover_cse: {
                        text: "📋 Post-Qualify and negotiate with the second (2nd) lowest Lowest Calculated (LC) or Most Advantageous (MA) bidder and adopt Negotiated Procurement",
                        next: "result_takeoverofcontracts"
                    },
                    different_prefer_takeover_cse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "directacquisition_abc_cse"
                    }
                }
            },
            repeatorder_previousprocurement_competitive_cse: {
                question: "Was the good procured under a contract previously awarded through Competitive Bidding, Limited Source Bidding, Competitive Dialogue, or Unsolicited Offer with Bid Matching?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "repeatorder_lowerunitprice_cse"
                    },
                    no: {
                        text: "❌ No",
                        next: "directacquisition_abc_cse"
                    }
                }
            },
            repeatorder_lowerunitprice_cse: {
                question: "Is the unit price equal to or lower than that provided in the original contract and the prevailing market price?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "repeatorder_previousprocurement_sixmonths_cse"
                    },
                    no: {
                        text: "❌ No",
                        next: "directacquisition_abc_cse"
                    }
                }
            },
            repeatorder_previousprocurement_sixmonths_cse: {
                question: "Is the procurement within six (6) months from the date of the NTP arising from the original contract?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "repeatorder_quantifiablegood_cse"
                    },
                    no: {
                        text: "❌ No",
                        next: "directacquisition_abc_cse"
                    }
                }
            },
            repeatorder_quantifiablegood_cse: {
                question: "Is the Good quantifiable, divisible, and consisting of at least four (4) units per item, and does not exceed 25% of the quantity of each item in the original contract?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_repeatorder_cse",
                        triggers: ["Repeat Order"]
                    },
                    no: {
                        text: "❌ No",
                        next: "directacquisition_abc_cse"
                    }
                }
            },
            prefer_repeatorder_cse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_repeatorder_cse: {
                        text: "📋 To Prepare Purchase Request and adopt Repeat Order",
                        next: "result_repeatorder"
                    },
                    different_prefer_repeatorder_cse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "directacquisition_abc_cse"
                    }
                }
            },
            prefer_twofailedbidding_cse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_twofailedbidding_cse: {
                        text: "📋 To Review terms, conditions, specifications, and cost estimates, and adjust ABC, if necessary and approved",
                        next: "result_directsales"
                    },
                    different_prefer_twofailedbidding_cse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "directacquisition_abc_cse"
                    }
                }
            },
            directacquisition_abc_cse: {
                question: "Is the ABC less than Php 200,000.00?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "smallvalueprocurement_abc"
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_directacquisition_cse"
                    }
                }
            },
            typeofgood_directacquisition_cse: {
                question: "Is the Good:",
                options: {
                    services_directacquisition_cse: {
                        text: "Services that may be procured from service providers, such as but not limited to, furniture repair, automotive service, restoration service, machine and fabrication, and other related services",
                        next: "availability_directacquisition_cse"
                    },
                    stores_directacquisition_cse: {
                        text: "May be procured from stores, such as but not limited to, department store, depot, fast food chain, grocery and supermarket, wholesale and retail store, convenience store, clothing and apparel store, bookstore, drugstore and pharmacy, automotive parts and accessories store, construction and hardware store, and online stores",
                        next: "availability_directacquisition_cse"
                    },
                    othergoods_directacquisition_cse: {
                        text: "❓ Not among the stated options"
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            availability_directacquisition_cse: {
                question: "Is the Good:",
                options: {
                    philgepsregistered_directacquisition_cse: {
                        text: "Supplied by a supplier registered with the PhilGEPS as verified from the PhilGEPS website",
                        next: "directacquisition_invoicecompliant_cse"
                    },
                    ecommerce_directacquisition_cse: {
                        text: "Available in electronic commerce platforms for delivery or pick up at such date and time identified by the PE",
                        next: "directacquisition_invoicecompliant_cse"
                    },
                    immediatedelivery_directacquisition_cse: {
                        text: "Readily available off-the-shelf and can be picked up or delivered immediately",
                        next: "directacquisition_invoicecompliant_cse"
                    },
                    otheravailability_directacquisition_cse: {
                        text: "❓ Not among the stated options"
                        next: "smallvalueprocurement_abc"
                    }
                }
            },
            directacquisition_invoicecompliant_cse: {
                question: "Is the ABC less than Php 200,000.00?",
                options: {
                    yes: {
                        text: "✅ Yes",
                        next: "prefer_directacquisition_cse",
                        triggers: ["Direct Acquisition"]
                    },
                    no: {
                        text: "❌ No",
                        next: "typeofgood_directacquisition_cse"
                    }
                }
            },
            prefer_directacquisition_cse: {
                question: "Do you prefer to:",
                options: {
                    yes_prefer_directacquisition_cse: {
                        text: "🤝 Adopting Direct Acquisition",
                        next: "result_communityparticipation"
                    },
                    different_prefer_directacquisition_cse: {
                        text: "🔄 Adopt different procurement mode",
                        next: "result_directacquisition"
                    }
                }
            }
        };

        const results = {
            result_competitivebidding: {
                title: "Competitive Bidding",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_limitedsourcebidding: {
                title: "Limited Source Bidding",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_competitivedialogue: {
                title: "Competitive Dialogue",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_unsolicitedofferwithbidmatching: {
                title: "Unsolicited Offer with Bid Matching",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_directcontracting: {
                title: "Direct Contracting",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_directacquisition: {
                title: "Direct Acquisition",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_repeatorder: {
                title: "Repeat Order",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_smallvalueprocurement: {
                title: "Small Value Procurement",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_twofailedbiddings: {
                title: "Negotiated Procurement: Two-Failed Biddings",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_emergencycases: {
                title: "Negotiated Procurement: Emergency Cases",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                link: "Negotiated Procurement_Emergency Cases.pdf",
                path: []
            },
            result_takeoverofcontracts: {
                title: "Negotiated Procurement: Take-Over of Contracts",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_adjacentorcontiguous: {
                title: "Negotiated Procurement: Adjacent or Contiguous",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_agencytoagency: {
                title: "Negotiated Procurement: Agency-to-Agency",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_scientificscholarlyetc: {
                title: "Negotiated Procurement: Scientific, Scholarly or Artistic Work, Exclusive Technology and Media Services",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_highlytechnicalconsultants: {
                title: "Negotiated Procurement: Highly Technical Consultants",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_defensecooperationagreement: {
                title: "Negotiated Procurement: Defense Cooperation Agreements and Inventory-Based Items",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_leaseofrealproperty: {
                title: "Negotiated Procurement: Lease of Real Property and Venue",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_ngoparticipation: {
                title: "Negotiated Procurement: Non-Government Organization (NGO) Participation",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_communityparticipation: {
                title: "Negotiated Procurement: Community Participation",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_unagencies: {
                title: "Negotiated Procurement: United Nations (UN) Agencies, International Organization or International Financing Organizations",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_directretailofpol: {
                title: "Negotiated Procurement: Direct Retail Purchase of Petroleum Fuel, Oil and Lubricant Products, Electronic Charging Devices, and Online Subscriptions",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_directsales: {
                title: "Direct Sales",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_directprocurementforsti: {
                title: "Direct Procurement for Science, Technology, and Innovation",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            },
            result_underconstruction: {
                title: "🚧 Under Construction",
                description: "This section is currently under development. Please check back later for guidance on this procurement type, or contact your procurement office for immediate assistance with your specific requirements.",
                path: []
            }
        };

        // Emoji mapping for procurement modes
        const procurementModeEmojis = {
            "Competitive Bidding": "🏆",            
            "Limited Source Bidding": "🎯",
            "Competitive Dialogue": "🤝",
            "Unsolicited Offer with Bid Matching": "⭐",
            "Direct Contracting": "🤝",
            "Direct Acquisition": "🤝",
            "Repeat Order": "📋",
            "Small Value Procurement": "💰",
            "Negotiated Procurement: Two-Failed Biddings": "🔄",
            "Negotiated Procurement: Emergency Cases": "🚨",
            "Negotiated Procurement: Take-over of Contracts": "📋",
            "Negotiated Procurement: Adjacent or Contiguous": "📋",
            "Negotiated Procurement: Agency-to-Agency": "🤝",
            "Negotiated Procurement: Scientific, Scholarly or Artistic Work, Exclusive Technology and Media Services": "🎓",
            "Negotiated Procurement: Highly Technical Consultants": "🌟",
            "Negotiated Procurement: Defense Cooperation Agreements and Inventory-Based Items": "🚁",
            "Negotiated Procurement: Lease of Real Property and Venue": "🤝",
            "Negotiated Procurement: Non-Government Organization (NGO) Participation": "🤝",
            "Negotiated Procurement: Community Participation": "🤝",
            "Negotiated Procurement: United Nations (UN) Agencies, International Organization or International Financing Organizations": "🤝",
            "Negotiated Procurement: Direct Retail Purchase of Petroleum Fuel, Oil and Lubricant Products, Electronic Charging Devices, and Online Subscriptions": "🤝",
            "Direct Sales": "🔄",
            "Direct Procurement for Science, Technology, and Innovation": "🔬"
        };

        // Emoji mapping for procurement modes
        const procurementModeLinks = {
            "Competitive Bidding": "🏆",            
            "Limited Source Bidding": "🎯",
            "Competitive Dialogue": "🤝",
            "Unsolicited Offer with Bid Matching": "⭐",
            "Direct Contracting": "🤝",
            "Direct Acquisition": "🤝",
            "Repeat Order": "📋",
            "Small Value Procurement": "💰",
            "Negotiated Procurement: Two-Failed Biddings": "🔄",
            "Negotiated Procurement: Emergency Cases": "Negotiated Procurement_Emergency Cases.pdf",
            "Negotiated Procurement: Take-over of Contracts": "📋",
            "Negotiated Procurement: Adjacent or Contiguous": "📋",
            "Negotiated Procurement: Agency-to-Agency": "🤝",
            "Negotiated Procurement: Scientific, Scholarly or Artistic Work, Exclusive Technology and Media Services": "🎓",
            "Negotiated Procurement: Highly Technical Consultants": "🌟",
            "Negotiated Procurement: Defense Cooperation Agreements and Inventory-Based Items": "🚁",
            "Negotiated Procurement: Lease of Real Property and Venue": "🤝",
            "Negotiated Procurement: Non-Government Organization (NGO) Participation": "🤝",
            "Negotiated Procurement: Community Participation": "🤝",
            "Negotiated Procurement: United Nations (UN) Agencies, International Organization or International Financing Organizations": "🤝",
            "Negotiated Procurement: Direct Retail Purchase of Petroleum Fuel, Oil and Lubricant Products, Electronic Charging Devices, and Online Subscriptions": "🤝",
            "Direct Sales": "🔄",
            "Direct Procurement for Science, Technology, and Innovation": "🔬"
        };

        let currentNode = 'start';
        let userPath = [];
        let breadcrumbPath = [];
        let availableModes = new Set();
        let history = [];

        function updateBreadcrumb() {
          const breadcrumbContainer = document.getElementById('breadcrumbContainer');
          const breadcrumbTrail = document.getElementById('breadcrumbTrail');
          breadcrumbTrail.innerHTML = '';
        
          // Add home button
          const homeButton = document.createElement('button');
          homeButton.className = 'breadcrumb-btn';
          homeButton.textContent = '🏠 Home';
          homeButton.onclick = () => restart();
          breadcrumbTrail.appendChild(homeButton);
        
          // Helper to truncate text
          function truncate(text, maxLength = 24) {
            if (text.length > maxLength) {
              return text.slice(0, maxLength - 3) + '...';
            }
            return text;
          }
        
          // Determine which breadcrumbs to show
          let itemsToShow = [];
          if (breadcrumbPath.length > 5) {
            // Show first, ellipsis, last 3
            itemsToShow = [
              { text: breadcrumbPath[0], index: 0 },
              { text: '...', isEllipsis: true },
              ...breadcrumbPath.slice(-3).map((text, i) => ({
                text,
                index: breadcrumbPath.length - 3 + i
              }))
            ];
          } else {
            itemsToShow = breadcrumbPath.map((text, i) => ({ text, index: i }));
          }
        
          // Render breadcrumbs
          itemsToShow.forEach((item, idx) => {
            // Separator
            const separator = document.createElement('span');
            separator.textContent = ' / ';
            separator.style.color = '#999';
            breadcrumbTrail.appendChild(separator);
        
            if (item.isEllipsis) {
              // Ellipsis, not clickable
              const ellipsis = document.createElement('span');
              ellipsis.className = 'breadcrumb-current';
              ellipsis.textContent = '...';
              breadcrumbTrail.appendChild(ellipsis);
            } else if (item.index < breadcrumbPath.length - 1) {
              // Clickable breadcrumb
              const breadcrumbBtn = document.createElement('button');
              breadcrumbBtn.className = 'breadcrumb-btn';
              breadcrumbBtn.textContent = truncate(item.text);
              breadcrumbBtn.title = item.text; // Show full text on hover
              breadcrumbBtn.onclick = () => navigateToStep(item.index);
              breadcrumbTrail.appendChild(breadcrumbBtn);
            } else {
              // Current breadcrumb (not clickable)
              const breadcrumbItem = document.createElement('span');
              breadcrumbItem.className = 'breadcrumb-current';
              breadcrumbItem.textContent = truncate(item.text);
              breadcrumbItem.title = item.text;
              breadcrumbTrail.appendChild(breadcrumbItem);
            }
          });
        
          // Show/hide container
          if (breadcrumbPath.length > 0) {
            breadcrumbContainer.style.display = 'block';
          } else {
            breadcrumbContainer.style.display = 'none';
          }
        }

        function updateDynamicRecommendations() {
            const dynamicContainer = document.getElementById('dynamicRecommendations');
            const badgesContainer = document.getElementById('recommendationBadges');
            
            badgesContainer.innerHTML = '';
            
            if (availableModes.size > 0) {
                // Convert Set to Array and create badges
                Array.from(availableModes).forEach(mode => {
                    const badge = document.createElement('div');
                    badge.className = 'recommendation-badge';
                    badge.innerHTML = `${procurementModeEmojis[mode] || '📋'} ${mode}`;
                    badgesContainer.appendChild(badge);
                });
                
                dynamicContainer.style.display = 'block';
            } else {
                dynamicContainer.style.display = 'none';
            }
        }

        function makeChoice(choice) {
            const currentNodeData = decisionTree[currentNode];
            const selectedOption = currentNodeData.options[choice];
            
            // Save current state to history
            history.push({
                node: currentNode,
                path: [...breadcrumbPath],
                modes: new Set(availableModes)
            });
            
            userPath.push(selectedOption.text);
            breadcrumbPath.push(selectedOption.text);
            
            // Add any triggered procurement modes to available modes
            if (selectedOption.triggers) {
                selectedOption.triggers.forEach(mode => {
                    availableModes.add(mode);
                });
            }
            
            currentNode = selectedOption.next;
            
            updateBreadcrumb();
            updateDynamicRecommendations();
            updateBackButton();
            
            if (currentNode.startsWith('result_')) {
                showResult();
            } else {
                showQuestion();
            }
        }

        function goBack() {
            if (history.length === 0) return;
            
            // Get previous state from history
            const previousState = history.pop();
            
            // Restore previous state
            currentNode = previousState.node;
            breadcrumbPath = previousState.path;
            availableModes = previousState.modes;
            
            updateBreadcrumb();
            updateDynamicRecommendations();
            updateBackButton();
            showQuestion();
        }

        function navigateToStep(stepIndex) {
            // Clear history and available modes
            history = history.slice(0, stepIndex);
            availableModes.clear();
            
            // Rebuild available modes up to the selected step
            for (let i = 0; i <= stepIndex; i++) {
                if (history[i] && history[i].modes) {
                    history[i].modes.forEach(mode => availableModes.add(mode));
                }
            }
            
            // Update breadcrumb path
            breadcrumbPath = breadcrumbPath.slice(0, stepIndex + 1);
            
            // Find the node for this step
            let tempNode = 'start';
            for (let i = 0; i <= stepIndex; i++) {
                const step = breadcrumbPath[i];
                const nodeData = decisionTree[tempNode];
                for (let optionKey in nodeData.options) {
                    if (nodeData.options[optionKey].text === step) {
                        tempNode = nodeData.options[optionKey].next;
                        break;
                    }
                }
            }
            
            currentNode = tempNode;
            
            updateBreadcrumb();
            updateDynamicRecommendations();
            updateBackButton();
            showQuestion();
        }

        function updateBackButton() {
            const backButton = document.getElementById('backButton');
            if (history.length > 0) {
                backButton.style.display = 'block';
            } else {
                backButton.style.display = 'none';
            }
        }

        function showQuestion() {
            document.getElementById('homeContainer').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('resultContainer').style.display = 'none';
            document.getElementById('dynamicRecommendations').style.display = 'block';
            
            const nodeData = decisionTree[currentNode];
            document.getElementById('questionText').textContent = nodeData.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            
            // Only replace with image options for the first question
            if (currentNode === 'start') {
                optionsContainer.innerHTML = `
                    <div class="image-option" onclick="makeChoice('goods')">
                        <img src="Billy Goods.png" style="width: 290px; height: 260px; object-fit: cover; border-radius: 8px;" alt="Goods icon" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                        <h3>Goods</h3>
                    </div>
                    <div class="image-option" onclick="makeChoice('infrastructure')">
                        <img src="Billy Infra.png" style="width: 290px; height: 260px; object-fit: cover; border-radius: 8px;" alt="Infrastructure icon" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                        <h3>Infrastructure Projects</h3>
                    </div>
                    <div class="image-option" onclick="makeChoice('consulting')">
                        <img src="Billy Consulting.png" style="width: 290px; height: 260px; object-fit: cover; border-radius: 8px;" alt="Consulting icon" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                        <h3>Consulting Services</h3>
                    </div>
                `;
            } else {
                // Use image options for yes/no questions
                if (currentNode === 'cse_goods' || 
                    currentNode === 'previouslyprocured_noncse' || 
                    currentNode === 'contractrescinded_noncse' ||
                    currentNode === 'directsales_previousprocurement_competitive' ||
                    currentNode === 'directsales_certificateofsatisfactoryperformance' ||
                    currentNode === 'directsales_previousprocurement_sixmonths' ||
                    currentNode === 'directsales_lowerunitprice' ||
                    currentNode === 'directsales_suppliercapability' ||
                    currentNode === 'repeatorder_previousprocurement_competitive_noncse' ||
                    currentNode === 'repeatorder_lowerunitprice_noncse' ||
                    currentNode === 'repeatorder_previousprocurement_sixmonths_noncse' ||
                    currentNode === 'repeatorder_quantifiablegood_noncse' ||
                    currentNode === 'retailpumpprice' ||
                    currentNode === 'immediateconsumption' ||
                    currentNode === 'directacquisition_abc_noncse' ||
                    currentNode === 'directacquisition_invoicecompliant_noncse' ||
                    currentNode === 'smallvalueprocurement_abc' ||
                    currentNode === 'prefer_competitivebidding_noncse' ||
                    currentNode === 'onlinesubscription_availablepsdbm' ||
                    currentNode === 'onlinesubscription_localprovider' ||
                    currentNode === 'onlinesubscription_abc' ||
                    currentNode === 'onlinesubscription_abc_hopeapproval' ||
                    currentNode === 'prefer_publicbidding_onlinesubscription' ||
                    currentNode === 'sagipsaka_accreditedffce' ||
                    currentNode === 'afpmodernizationprogram_noncse' || 
                    currentNode === 'afpmodernizationprogram_directnegotiation_noncse' ||
                    currentNode === 'afpmodernizationprogram_previouscontract_noncse' ||
                    currentNode === 'afpmodernizationprogram_performancesecurity_noncse' ||
                    currentNode === 'publicownedvenue' ||
                    currentNode === 'efficientandeconomical_venue' ||
                    currentNode === 'agencymandate_realpropertyvenue' ||
                    currentNode === 'newconcepttechnology_noncse' ||
                    currentNode === 'unsolicitedoffer_noncse' ||
                    currentNode === 'researchuse_noncse' ||
                    currentNode === 'approvedlist_limitedsourcebidding_noncse' ||
                    currentNode === 'ngo_appropriationlaw_noncse' ||
                    currentNode === 'necessarytools_agencytoagency_noncse' ||
                    currentNode === 'directacquisition_abc_noncse' ||
                    currentNode === 'directacquisition_invoicecompliant_noncse' ||
                    currentNode === 'availablepsdbm_cse' ||
                    currentNode === 'previouslyprocured_cse' ||
                    currentNode === 'previouscontract_takeovercontract_cse' ||
                    currentNode === 'repeatorder_previousprocurement_competitive_cse' ||
                    currentNode === 'repeatorder_lowerunitprice_cse' ||
                    currentNode === 'repeatorder_previousprocurement_sixmonths_cse' ||
                    currentNode === 'repeatorder_quantifiablegood_cse' ||
                    currentNode === 'directacquisition_abc_cse' ||
                    currentNode === 'compliantinvoice_directacquisition_cse') {
                    optionsContainer.className = 'options horizontal';
                    optionsContainer.innerHTML = `
                        <div class="image-option" onclick="makeChoice('yes')">
                            <img src="YES.png" style="width: 130px; height: 70px; object-fit: cover; border-radius: 1px;" alt="Yes icon" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                        </div>
                        <div class="image-option" onclick="makeChoice('no')">
                            <img src="NO.png" style="width: 130px; height: 70px; object-fit: cover; border-radius: 1px;" alt="No icon" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                        </div>
                    `;
                } else {
                    // Use regular buttons for other questions
                    optionsContainer.className = 'options';
                    optionsContainer.innerHTML = '';
                    
                    for (let optionKey in nodeData.options) {
                        const option = nodeData.options[optionKey];
                        const button = document.createElement('button');
                        button.className = 'option-btn';
                        button.textContent = option.text;
                        button.onclick = () => makeChoice(optionKey);
                        optionsContainer.appendChild(button);
                    }
                }
            }
        }

        function showResult() {
            const result = results[currentNode];
            
            document.getElementById('homeContainer').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('resultContainer').style.display = 'block';
            
            const recommendationContainer = document.getElementById('recommendationContainer');
            recommendationContainer.innerHTML = '';

            // ✅ Prevent duplication of the main recommendation
            for (let mode of availableModes) {
                if (mode.toLowerCase().trim() === result.title.toLowerCase().trim()) {
                    availableModes.delete(mode);
                    break;
                }
            }

            document.getElementById('homeContainer').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('resultContainer').style.display = 'block';
            
            // Create primary recommendation with clickable link
            const primaryRecommendation = document.createElement('div');
            primaryRecommendation.className = 'primary-recommendation';
            primaryRecommendation.innerHTML = `
                <div class="recommendation-title">
                    <span class="icon">🏆</span>
                    <span>Primary Recommendation</span>
                </div>
                <div class="recommendation-description">
                    <strong>${result.title}</strong><br><br>
                    ${result.description}
                    ${result.link ? `<br><br><a href="${result.link}" target="_blank" class="learn-more-btn">🔗 Learn more about this mode</a>` : ''}
                </div>
            `;
            recommendationContainer.appendChild(primaryRecommendation);
            
            // Create alternative recommendations with clickable badges
            if (availableModes.size > 0) {
                const alternativeContainer = document.createElement('div');
                alternativeContainer.className = 'alternative-recommendations';
                
                const alternativeTitle = document.createElement('div');
                alternativeTitle.className = 'alternative-title';
                alternativeTitle.innerHTML = '<span class="icon">💡</span> Other Recommended Procurement Modes:';
                alternativeContainer.appendChild(alternativeTitle);
                
                const alternativeBadges = document.createElement('div');
                alternativeBadges.className = 'alternative-badges';
                
                Array.from(availableModes).forEach(mode => {
                    const badge = document.createElement('a');
                    badge.className = 'alternative-badge';
                    badge.href = procurementModeLinks[mode] || '#';
                    badge.target = '_blank';
                    badge.innerHTML = `${procurementModeEmojis[mode] || '📋'} ${mode}`;
                    alternativeBadges.appendChild(badge);
                });
                
                alternativeContainer.appendChild(alternativeBadges);
                recommendationContainer.appendChild(alternativeContainer);
            }
            
            document.getElementById('dynamicRecommendations').style.display = 'none';
        }

        function startDecisionTree() {
            document.getElementById('homeContainer').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('dynamicRecommendations').style.display = 'block';
            showQuestion();
        }

        function restart() {
            // Reset all variables completely
            currentNode = 'start';
            userPath = [];
            breadcrumbPath = [];
            availableModes.clear();
            history = [];
    
            // Reset all UI elements - GO TO FIRST QUESTION INSTEAD OF HOME
            document.getElementById('homeContainer').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('resultContainer').style.display = 'none';
            document.getElementById('breadcrumbContainer').style.display = 'none';
            document.getElementById('dynamicRecommendations').style.display = 'block';
            document.getElementById('backButton').style.display = 'none';
            
            // Clear any dynamic content
            document.getElementById('recommendationBadges').innerHTML = '';
            document.getElementById('recommendationContainer').innerHTML = '';
            
            // Show the first question
            showQuestion();
        }

        // Initialize - FIXED: Show home screen instead of first question
        document.getElementById('homeContainer').style.display = 'block';
        document.getElementById('questionContainer').style.display = 'none';
        document.getElementById('resultContainer').style.display = 'none';
        document.getElementById('breadcrumbContainer').style.display = 'none';
        document.getElementById('dynamicRecommendations').style.display = 'none';

        function openFeedbackForm() {
        window.open('https://forms.office.com/Pages/ResponsePage.aspx?id=t4cJLfDqkEG0q9B_9ONFBILVbW3cIK9Grl4vnQmaLbpUNFZaSkMwOUUyR0MyQ0pRMUVUSFVNN080UCQlQCN0PWcu', '_blank');
        }

        function openUserGuide() {
          window.open('User_Guide.pdf', '_blank'); 
        }

</script>
